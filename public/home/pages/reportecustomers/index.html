<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>报备客户</title>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta content="telephone=no" name="format-detection" />
    <!-- 引入YDUI样式 -->
    <link rel="stylesheet" href="../../build/css/ydui.css" />
	<link rel="stylesheet" href="../../css/common.css" />
	<link href="../../css/datacss/mobiscroll.animation.css" rel="stylesheet" type="text/css" />
	<link href="../../css/datacss/mobiscroll.widget.css" rel="stylesheet" type="text/css" />
	<link href="../../css/datacss/mobiscroll.widget.ios.css" rel="stylesheet" type="text/css" />
	<link href="../../css/datacss/mobiscroll.scroller.css" rel="stylesheet" type="text/css" />
	<link href="../../css/datacss/mobiscroll.scroller.ios.css" rel="stylesheet" type="text/css" />
	<style>
		input,textarea{
			font-family: initial;
		}
		#data-form {
			padding:.2rem .5rem;
		}
		#data-form div{
			display: flex;
			align-items: center;
			padding: .3rem 0;
			
		}
		#data-form div label{
			min-width: 1.5rem;
			color: #868686;
			font-size: .25rem;
			
			padding: 0 .3rem 0 0 ;
		}
		#data-form div input{
			text-align: right;
			border-radius: .1rem;
			width: 100%;
			border: 0;
			background: #EEEEEE;
			padding: .2rem;
			height: .7rem !important;
			font-size: 0.1rem;
			
		}
		textarea{
			border-radius: .1rem;
			width: 100%;
			border: 0;
			background: #EEEEEE;
			padding: .2rem;
			font-size: 0.1rem;
		}
		.cell-item:not(:last-child):after{
			border: 0;
		}
		.cell-item{
			margin-left: .5rem;
		}

		.cell-checkbox-icon:after{
			color:#C1060F !important;
		}
		.submit{
			text-align: center;
			display: block;
			margin: 0 auto;
			border-radius: .2rem;
			background: #C1060F;
			color: #ffffff;
			padding: .2rem .5rem;
			margin-top: .5rem !important;
		}
		#J_ShowActionSheet{
			display: block !important;
			padding: 0 !important;
		}
		
	</style>
</head>
<body>
	<section class="g-flexview">
		<!-- 顶部内容 -->
		<header class="m-navbar">
			<a href="#" onClick="javascript :history.back(-1);" class="navbar-item">
				<i class="back-ico"></i>
			</a>
			<div class="navbar-center">
				<span class="navbar-title">报备客户</span>
			</div>
		</header>
		<div class="g-scrollview">
			<div id="data-form">
				<div class="">
					<label>报备楼盘</label>
					<input id="J_ActionSheet" value="" name="currenArea" type="text" readonly="readonly"  placeholder="请选择楼盘" />
					<div class="m-actionsheet" id="J_ShowActionSheet">
						<a href="#" class="actionsheet-item">香御·圣联公馆</a>
						<a href="#" class="actionsheet-item">兴园小区</a>
						<a href="#" class="actionsheet-item">保利·香槟国际</a>
						<a href="javascript:;" class="actionsheet-action" id="J_Cancel">取消</a>
					</div>
				</div>
				<div class="">
					<label>客户姓名</label>
					<input value="" name="customername" type="text"  placeholder="请输入真实姓名" />
				</div>
				<div class="">
					<label>客户电话</label>
					<input type="number" pattern="[0-9]*" class="cell-input" placeholder="请输入客户联系方式" value="" name="tel" autocomplete="off" />
				</div>
				<div class="">
					<label>客户性别</label>
					<label class="cell-item">
						<span class="cell-left">男</span>
						<label class="cell-right">
							<input type="radio" name="sex" checked="checked" value="1" />
							<i class="cell-checkbox-icon"></i>
						</label>
					</label>
					
					<label class="cell-item">
						<span class="cell-left">女</span>
						<label class="cell-right">
							<input type="radio" name="sex" value="2" />
							<i class="cell-checkbox-icon"></i>
						</label>
					</label>
				</div>
				<div class="">
					<label>预看时间</label>
					<input id="dateinput" value="" name="user_date" type="text"   placeholder="请选择看盘时间" />
				</div>
				<div class="">
					<label>购房意向</label>
					<textarea id='desccontent' rows="10" cols="50" placeholder="请输入购房意向,例如:三室一厅..."></textarea>
				</div>
				<span class="submit" id="postcustomer">立即报备</span>
			</div>
		</div>
	</div>
<!-- 引入jQuery 3.0+ -->
<script src="../../js/jq331.min.js"></script>
<script src="../../build/js/ydui.flexible.js"></script>
<script src="../../build/js/ydui.js"></script>
<script src="../../js/common.js"></script>
<script src="../../js/datajs/mobiscroll.core.js"></script>
<script src="../../js/datajs/mobiscroll.widget.js"></script>
<script src="../../js/datajs/mobiscroll.scroller.js"></script>
<script src="../../js/datajs/mobiscroll.util.datetime.js"></script>
<script src="../../js/datajs/mobiscroll.datetimebase.js"></script>
<script src="../../js/datajs/mobiscroll.widget.ios.js"></script>
<script src="../../js/datajs/mobiscroll.i18n.zh.js"></script>
<script>
$(document).ready(function(){
	var postcustomerApi = commapi + "order/add";
	if(!dataToken){
		!function (win, $) {
			var dialog = win.YDUI.dialog;													
			dialog.confirm('系统提示', '您还没有登录，现在去登录...', [
				{
					txt: '取消',
					color: false, /* false:黑色  true:绿色 或 使用颜色值 */
					callback: function () {
						history.go(-1);
					}
				},
				{
					txt: '确定',
					color: true,
					callback: function () {
						location.href="../login.html";
					}
				}
			]);
		}(window, jQuery);					
		return;
	}
	//token判断时效，超时退出登录
	var _interval_handler=-1;
	var _EXPIRE_TIME = datamoretime;//判断时效时间，则注销
	(function () {
		if (dataToken) {//已登录
		//刷新最后使用时间
		sessionStorage.setItem("nxgx_lastVisitTime", new Date().getTime());
		_interval_handler=setInterval(checkExpired, 10*1000);//10秒钟检查一次，是否超时
		}
	})();
	
	function checkExpired() {
	console.log("10秒检查一次是否过期"+window.location.href+"::"+new Date());
	var storeLastTime=sessionStorage.getItem("nxgx_lastVisitTime")?sessionStorage.getItem("nxgx_lastVisitTime"):-1;
	if (storeLastTime==-1) clearInterval(_interval_handler);
	else {
			if ((new Date()).getTime()-storeLastTime>_EXPIRE_TIME) {  //过期了
			!function (win, $) {
				var dialog = win.YDUI.dialog;
				/* 加载中提示框 */									
					dialog.loading.open('登录超时...');
					setTimeout(function () {
						dialog.loading.close();/* 移除loading */
						location.href="../login.html";
					}, 2000);
			
			}(window, jQuery);	
			clearInterval(_interval_handler);
		}
	}
	};

	//报备楼盘选择
    var $as = $('#J_ShowActionSheet');
    $('#J_ActionSheet').on('click', function () {
        $as.actionSheet('open');
    });
    $('#J_Cancel').on('click', function () {
        $as.actionSheet('close');
    });
	
	$('#J_ShowActionSheet a').click(function(){
		var currenArea = $(this).html();
		if(currenArea != '取消'){
			$("input[name='currenArea']").val(currenArea);
			$as.actionSheet('close');
		}
	});

	//日期控件
	$(function () {
		var nowData=new Date();
		var opt= { 
			theme:'ios', //设置显示主题 
			mode:'scroller', //设置日期选择方式，这里用滚动
			display:'bottom', //设置控件出现方式及样式
			preset : 'datetime', //日期:年 月 日 时 分
			minDate: nowData, 
			maxDate:new Date(nowData.getFullYear(),nowData.getMonth(),nowData.getDate()+365),
			dateFormat: 'yy-mm-dd', // 日期格式
			//dateOrder: 'yymmdd', //面板中日期排列格式
			//stepMinute: 5, //设置分钟步长
			yearText:'年', 
			monthText:'月',
			dayText:'日',
			//hourText:'时',
			//minuteText:'分',
			lang:'zh' //设置控件语言};
		};
		$('#dateinput').mobiscroll(opt);
	});
	
	//报备客户
	$('#postcustomer').click(function(){
		var customerName = $("input[name='customername']").val();
		var customerTel = $("input[name='tel']").val();
		var customerSex = $("input[name='sex']:checked").val();
		var dataTime = $('#dateinput').val();
		var descTencent = $("#desccontent").val();
		$.ajax({
			url: postcustomerApi,
			type: "POST",
			data: {'name': customerName, 'number': customerTel, 'gender': customerSex, 'date': dataTime, 'content': descTencent},
			beforeSend: function(request) {
                        request.setRequestHeader("token", dataToken);
                    },
			success: function(result) {
				console.log(result);//成功
					!function (win, $) {
						var dialog = win.YDUI.dialog;						
							dialog.toast(result.msg, 'success', 2000);
				}(window, jQuery);	
			}
// 			error:function(msg){
// 					console.log(msg) // 失败返回
// 					console.log('0')
// 					var json=JSON.parse(msg.responseText);
// 					// 验证不通过
// 					if(json.errorCode==40000){
// 							alert(json.msg);
// 					}
// 					// 用户名不存在
// 					if(json.errorCode==40301){
// 							alert(json.msg);
// 					}
// 			}
		});
		
	});
	
});
</script>

</body>
</html>